import { parseTorusRedirectParams } from "./parseTorusRedirectParams";

// we get URL params in a compressed format generated by zipurl
const googleAuthDeeplink =
  "umami://auth/H4sIAAAAAAAAA51VSY-zyBL8NV_f3ILCuM2hD2AWY1Ngs1OXFptZXAXYgFl-_QNP683oSXN5EqhQQWZlREYkRfHdU_txGuu56h8fcR5WVYq_n2lSPNO4-_nd-PnnR233nU6nJqp0KvDYEjn4rpZ1kdj8Nj3ibcQ0feJLhXY4AeSfGkQwjgt1p1ZuF3h0oxZDkRzxgByO2ApXhd62MIpTFQGuihRnjZuQZzYxcctENl82I-CIuJNaNlRcufh2_QNYwDLi7_IRdt9TCLjPkOJvwk808QeJCaaKvdoDOTz0Pe-r5xxTkg3QELMQCSMhcpOAjXzWaCHTmK9oCuyWUOdn6bjRrWA942Ezmzl7HISzEXDZGGn8cxCC-YZ9Y-Sn1OY4ykmUyN_iY6bMG-sJ2WvKP8wvlqcOznC2xk68lJtrhINrj81g1F6PVLWH8JAFZ96PLd5ULfl6VHwAC-umZkpTeUnc-hteq3OluMCBonfcR1p8MyzHfbTxd0rCAq-YqeZZ3wqcvp_rJq2K5P2Yd13T_mH4P0BermEYPrO6znAaNkX7Gddk2Qz7Ll-Wvk2fRXWrP__O-X8E_5bxUbz1kEdKvPbRcmaV1gu1VUnXoMPS91ImuigQqEhb5AUzErMtFO-MoZilIZ4ILN0SguWel7bNKNc9lTHEt36o1OfXnGeXvha36-cqu5iB61adHM0hnuuXBuQyABwdVeaskeQVgaRFFltGgFpT5Gm1plBHKMaDbscTnAPKEPmt5l1n6LFtCFgceBSNPAegozokR2cyFPQIyWlGSkcSRaI1Ig_xEfYIcC8ERpz4Oo6J_lrOxFF17Zfzu1XWge--rQBtnoGiw8AFmC5mg3Gg73CW-0jpeuTJne65WCfmBI8mDcuchKQpYmA-UWXmusXm8VH4G4vvzouNFjwshTyW0tZzrYXeSqeD1ValNCx0Ubq9nCdCAMUFnx1TsMwWptY25H_Z87hYVrn3ieKW4WHdX-2I2_VdDNwJAZfVlpatPCJv5P_te59BC3ZMQm_F-pclV54TmasDX6_XfI6n323APlLf3OqiXJm2SfRKf1lEppy1dsK-IqLjfxkbfUCCwiillcNZFwNm4XCNySPPWXtvL3xUyL9nFsB9ctRxtNZXCU3AmHRMnP_Rx1jDif0dLy69Yl36teLqk8NbJ6_A4oQriLcR0E_IQ5fI6VST1ptYQVV0x0pKTAdKuWrZCUgkdAglWU_tnLVmtI0xEjzP4eL5DjQPrvVXoY9whLl-GXdvjM4vv6tGEJG70BtZH_wXjxYufV3qatf3kcKVgTe-45C37UxKXXM2gX_9ByeLlt-cuNt4sRi0V21D-t37w1CEldms8cHMjwFxaF1MiGEv6xzTAYAUBOoMy8Wmdl7qM08bdlIE9tsjyzg6cZ9od94AxTneOj0QJ7MxzmdTGtHliTfb-8stwq87Omwa4Uc3klhEPw81DUb_Pu7I-W5Rzy32TiE851Dtg2SbZWluxRk2-ebr1Zqplmh7y27Vn6-dsG-S8HLazwJ57GN8TjmQXSl3o4YFk1wT2RkPD1JIynysqUIQdiBMVam7tKWYzUIapjo4uTaz6OVmBrg8VmehlmTuVOgJYiYoTAk9ieBQ9j61P1_IT7vvzsMk9Lv55YhfyebpnS8_nHjFvRb1lTen6eNySc4pNSpNtB11W6ppVxOaQpTy0Xi9DJ4NXLO1UnbsIWfxCneRuP12mXKeaZS7o4FHK6y-5K_4JsUd5I9q-sj7QKd2e0_js4_wm_povuO6atOq-3gV3wcy3hwanXzKPZnM8q8D2NQlrJtSItgevkJRPjjYtSy3aQ0_hy5zHRzQjpGMPbcyrcgJpnV4QbcJXJJ7kBEMh3ZDSMzWcDjDJWPoePfRdNXBwUnputJoY1SmivlYhtEdVsIc3PPacXEfys09off_AYBvCkASCAAA";

test("parseTorusRedirectParams", () => {
  expect(parseTorusRedirectParams(googleAuthDeeplink)).toEqual({
    channel: "redirect_channel_u08xyxoznuq",
    data: {
      hashParams: {
        access_token:
          "ya29.a0AfB_byACE3Yyn5QTwmCqN8AXIKhl0ET2Zwc5MZBxmmFpd2-FKL1BgL37byYTsm0KrjUVbfi5WOqT3-zgqCBKOY9gxbLArwBYzflXOxAyeT990UdGbX4lHgGz-SrM5QeAqR75A0CUwKSxtDPj-QblYQulRYxLvqeITwaCgYKAXcSARISFQHGX2MiSfIgGpnWdcsX-ALohGiPMw0169",
        authuser: "0",
        expires_in: "3599",
        hd: "trili.tech",
        id_token:
          "eyJhbGciOiJSUzI1NiIsImtpZCI6IjFmNDBmMGE4ZWYzZDg4MDk3OGRjODJmMjVjM2VjMzE3YzZhNWI3ODEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIxMDcwNTcyMzY0ODA4LWQzMW5sa25lYW01ZWU2ZHIwdHUyOGZqamJzZGtmdGE1LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiYXVkIjoiMTA3MDU3MjM2NDgwOC1kMzFubGtuZWFtNWVlNmRyMHR1Mjhmampic2RrZnRhNS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjEwODE0NTU3MDM2MDY0OTc0Mjg3MiIsImhkIjoidHJpbGkudGVjaCIsImVtYWlsIjoic2VyZ2V5LmtpbnRzZWxAdHJpbGkudGVjaCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiUWNkT25qeXR4NDFnRTRmNnNvSmF0USIsIm5vbmNlIjoidTA4eHl4b3pudXEiLCJuYmYiOjE3MDUzNDY3NDgsIm5hbWUiOiJTZXJnZXkgS2ludHNlbCIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NJZWZPbUtIR1NpcGZnbklGemRUMEhISTd2dEZCaEFNeTh5SzZ4clZBWWU9czk2LWMiLCJnaXZlbl9uYW1lIjoiU2VyZ2V5IiwiZmFtaWx5X25hbWUiOiJLaW50c2VsIiwibG9jYWxlIjoiZW4tR0IiLCJpYXQiOjE3MDUzNDcwNDgsImV4cCI6MTcwNTM1MDY0OCwianRpIjoiYzAxYmU1NDdmOTU1Nzc1Y2M0M2IzMjI1NThjNzA1OTdiYTIxMDc2MiJ9.Z6K-2GUHftNYDyRpOKKRExZPrl-4kvVia7kZC-pB_NOdcDZ_qIeYxXkx6mKkS0r4lWJaMKhMIuYd4ggehScglRAp7vsReLdL8STsI_76B8pdaPJ8zBmq8clKe92gQ0V-Iai3dQdFUxCqmiEGzHo0iBB62aeIEtPsjDgzBeaeN2JVT3uYmfRYljHnKBoEF9JiNdZ3yMByd1yD2CjuX08KPm_s8tKwyBu6zvUD7d-rWKP_9DQluLbunWzeeqPPdKe0xGpb4xNTEo1VLBpiDEhxOvvOA5YVRsSe5xuM9SAG9PE984ZCIWROj6HOlxSan7F7cfEctMAHIeqhuYN068WLAg",
        prompt: "consent",
        scope:
          "email%20profile%20openid%20https://www.googleapis.com/auth/userinfo.email%20https://www.googleapis.com/auth/userinfo.profile",
        state:
          "eyJpbnN0YW5jZUlkIjoidTA4eHl4b3pudXEiLCJ2ZXJpZmllciI6InVtYW1pIiwidHlwZU9mTG9naW4iOiJnb29nbGUiLCJyZWRpcmVjdFRvT3BlbmVyIjp0cnVlfQ%253D%253D",
        token_type: "Bearer",
      },
      instanceParams: {
        instanceId: "u08xyxoznuq",
        redirectToOpener: "true",
        typeOfLogin: "google",
        verifier: "umami",
      },
    },
    error: null,
  });
});
